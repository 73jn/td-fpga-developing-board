--
-- VHDL Architecture Poetic_test.poetic_test.struct
--
-- Created:
--          by - jean.nanchen.UNKNOWN (WEA30407)
--          at - 14:10:12 08.07.2021
--
-- Generated by Mentor Graphics' HDL Designer(TM) 2019.2 (Build 5)
--
LIBRARY ieee;
  USE ieee.std_logic_1164.all;
  USE ieee.numeric_std.ALL;

LIBRARY Modulation;
LIBRARY Poetic;
LIBRARY Poetic_test;
LIBRARY WaveformGenerator;

ARCHITECTURE struct OF poetic_test IS

    -- Architecture declarations
    constant signalBitNb: positive := 12;
    constant adcBitNb: integer := 12;
    constant dataBitNb: positive := 16;
    constant phaseBitNb: positive := 16;
    constant pidBitNb: integer := 12;
    constant inputBitNb: positive := 12;
    constant outputBitNb : positive := 12;

    -- Internal signal declarations
    SIGNAL ADC_SCLK   : std_ulogic;
    SIGNAL CS_n       : std_ulogic;
    SIGNAL Data       : std_ulogic_vector(adcBitNb-1 DOWNTO 0);
    SIGNAL SDO        : std_ulogic;
    SIGNAL Setval     : std_ulogic_vector(pidBitNb-1 DOWNTO 0);
    SIGNAL clock      : std_logic;
    SIGNAL enable     : std_ulogic;
    SIGNAL lowpassIn  : unsigned(signalBitNb-1 DOWNTO 0);
    SIGNAL lowpassOut : unsigned(signalBitNb-1 DOWNTO 0);
    SIGNAL notenable  : std_ulogic;
    SIGNAL output     : unsigned(pidBitNb-1 DOWNTO 0);
    SIGNAL reset      : std_logic;
    SIGNAL serialOut  : std_ulogic;
    SIGNAL speed      : std_ulogic_vector(11 DOWNTO 0);


    -- Component Declarations
    COMPONENT pwmModulator
    GENERIC (
        signalBitNb : positive := 16
    );
    PORT (
        clock      : IN     std_ulogic ;
        parallelIn : IN     unsigned (signalBitNb-1 DOWNTO 0);
        reset      : IN     std_ulogic ;
        serialOut  : OUT    std_ulogic 
    );
    END COMPONENT;
    COMPONENT ADC
    GENERIC (
        adcBitNb : integer := 12
    );
    PORT (
        SCLK   : IN     std_ulogic ;
        SDO    : IN     std_ulogic ;
        clock  : IN     std_ulogic ;
        enable : IN     std_ulogic ;
        reset  : IN     std_ulogic ;
        CS_n   : OUT    std_ulogic ;
        Data   : OUT    std_ulogic_vector (adcBitNb-1 DOWNTO 0)
    );
    END COMPONENT;
    COMPONENT clockGenerator
    GENERIC (
        counterBitNb : integer := 12;
        countValue   : integer := 250
    );
    PORT (
        clock    : IN     std_ulogic ;
        enable   : IN     std_ulogic ;
        reset    : IN     std_ulogic ;
        clockOut : OUT    std_ulogic 
    );
    END COMPONENT;
    COMPONENT regulator
    GENERIC (
        pidBitNb : positive := 12
    );
    PORT (
        Setval        : IN     std_ulogic_vector (pidBitNb-1 DOWNTO 0);
        adc_data      : IN     std_ulogic_vector (pidBitNb-1 DOWNTO 0);
        clock         : IN     std_ulogic ;
        kd_sw         : IN     std_ulogic ;
        ki_sw         : IN     std_ulogic ;
        kp_sw         : IN     std_ulogic ;
        on_off_switch : IN     std_ulogic ;
        reset         : IN     std_ulogic ;
        update        : IN     std_ulogic ;
        output        : OUT    unsigned (pidBitNb-1 DOWNTO 0)
    );
    END COMPONENT;
    COMPONENT AD
    GENERIC (
        adcBitNb : positive := 12
    );
    PORT (
        CS_n       : IN     std_ulogic ;
        DataToSend : IN     std_ulogic_vector (adcBitNb-1 DOWNTO 0);
        SCLK       : IN     std_ulogic ;
        clock      : IN     std_logic ;
        reset      : IN     std_logic ;
        SDO        : OUT    std_ulogic 
    );
    END COMPONENT;
    COMPONENT motor
    PORT (
        Vapp  : IN     unsigned (11 DOWNTO 0);
        clock : IN     std_logic ;
        reset : IN     std_logic ;
        speed : OUT    std_ulogic_vector (11 DOWNTO 0)
    );
    END COMPONENT;
    COMPONENT poetic_tester
    GENERIC (
        adcBitNb   : integer  := 12;
        phaseBitNb : positive := 16;
        pidBitNb   : positive := 12
    );
    PORT (
        Setval    : OUT    std_ulogic_vector (pidBitNb-1 DOWNTO 0);
        clock     : OUT    std_logic ;
        enable    : OUT    std_ulogic ;
        notenable : OUT    std_ulogic ;
        reset     : OUT    std_logic 
    );
    END COMPONENT;
    COMPONENT lowpass
    GENERIC (
        signalBitNb : positive := 16;
        shiftBitNb  : positive := 12
    );
    PORT (
        lowpassOut : OUT    unsigned (signalBitNb-1 DOWNTO 0);
        clock      : IN     std_ulogic ;
        reset      : IN     std_ulogic ;
        lowpassIn  : IN     unsigned (signalBitNb-1 DOWNTO 0)
    );
    END COMPONENT;

    -- Optional embedded configurations
    -- pragma synthesis_off
    FOR ALL : AD USE ENTITY Poetic_test.AD;
    FOR ALL : ADC USE ENTITY Poetic.ADC;
    FOR ALL : clockGenerator USE ENTITY Poetic.clockGenerator;
    FOR ALL : lowpass USE ENTITY WaveformGenerator.lowpass;
    FOR ALL : motor USE ENTITY Poetic_test.motor;
    FOR ALL : poetic_tester USE ENTITY Poetic_test.poetic_tester;
    FOR ALL : pwmModulator USE ENTITY Modulation.pwmModulator;
    FOR ALL : regulator USE ENTITY Poetic.regulator;
    -- pragma synthesis_on


BEGIN
    -- Architecture concurrent statements
    -- HDL Embedded Text Block 1 eb1
    -- eb1 1                                        
    LowpassIn <= (others => serialOut);


    -- Instance port mappings.
    I43 : pwmModulator
        GENERIC MAP (
            signalBitNb => 12
        )
        PORT MAP (
            clock      => clock,
            parallelIn => output,
            reset      => reset,
            serialOut  => serialOut
        );
    I3 : ADC
        GENERIC MAP (
            adcBitNb => 12
        )
        PORT MAP (
            SCLK   => ADC_SCLK,
            SDO    => SDO,
            clock  => clock,
            enable => enable,
            reset  => reset,
            CS_n   => CS_n,
            Data   => Data
        );
    I2 : clockGenerator
        GENERIC MAP (
            counterBitNb => 12,
            countValue   => 100
        )
        PORT MAP (
            clock    => clock,
            enable   => enable,
            reset    => reset,
            clockOut => ADC_SCLK
        );
    I8 : regulator
        GENERIC MAP (
            pidBitNb => 12
        )
        PORT MAP (
            Setval        => Setval,
            adc_data      => Data,
            clock         => clock,
            kd_sw         => enable,
            ki_sw         => enable,
            kp_sw         => enable,
            on_off_switch => enable,
            reset         => reset,
            update        => CS_n,
            output        => output
        );
    I1 : AD
        GENERIC MAP (
            adcBitNb => 12
        )
        PORT MAP (
            CS_n       => CS_n,
            DataToSend => speed,
            SCLK       => ADC_SCLK,
            clock      => clock,
            reset      => reset,
            SDO        => SDO
        );
    I0 : motor
        PORT MAP (
            Vapp  => lowpassOut,
            clock => clock,
            reset => reset,
            speed => speed
        );
    I_tester : poetic_tester
        GENERIC MAP (
            adcBitNb   => 12,
            phaseBitNb => 16,
            pidBitNb   => 12
        )
        PORT MAP (
            Setval    => Setval,
            clock     => clock,
            enable    => enable,
            notenable => notenable,
            reset     => reset
        );
    I4 : lowpass
        GENERIC MAP (
            signalBitNb => 12,
            shiftBitNb  => 16
        )
        PORT MAP (
            lowpassOut => lowpassOut,
            clock      => clock,
            reset      => reset,
            lowpassIn  => lowpassIn
        );

END struct;
